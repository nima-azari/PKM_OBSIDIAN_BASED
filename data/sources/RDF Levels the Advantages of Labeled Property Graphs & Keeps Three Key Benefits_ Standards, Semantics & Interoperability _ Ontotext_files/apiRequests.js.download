const HEADERS={'Content-Type':'application/x-www-form-urlencoded',};const emptyContainers=(chatResponseContainer,sourcesList,resultsContainer)=>{chatResponseContainer.innerHTML='';sourcesList.innerHTML='';resultsContainer.innerHTML=''};const copyResponseToClipboard=(chatResponseContainer,questionHolder)=>{const chatResponseCopyToClipboard=document.querySelector('.ott-chat-response-copy');if(!chatResponseCopyToClipboard)return;chatResponseCopyToClipboard.onclick=()=>{copyToClipboard(chatResponseCopyToClipboard,chatResponseContainer.textContent,chatResponseContainer.innerHTML,questionHolder.textContent,questionHolder.innerHTML)}};const copyToClipboard=async(chatResponseCopyToClipboard,text,html,question,questionHtml)=>{if(!text||!chatResponseCopyToClipboard)return;if(window.isSecureContext&&navigator.clipboard){if(html){await navigator.clipboard.write([new ClipboardItem({'text/html':new Blob([questionHtml,html],{type:'text/html'}),'text/plain':new Blob([question,text],{type:'text/plain'})})])}else{navigator.clipboard.writeText(text)}
chatResponseCopyToClipboard.classList.add('copied');setTimeout(()=>chatResponseCopyToClipboard.classList.remove('copied'),2000)}}
const copyTopicUrl=()=>{const copyTopicURLButtons=document.querySelectorAll('.ott-topics-button');if(!copyTopicURLButtons||!copyTopicURLButtons.length)return;copyTopicURLButtons.forEach(button=>{button.onclick=()=>{const url=button.parentElement.querySelector('a').getAttribute('href');if(!url)return;copyToClipboard(button,url)}})};const feedbackRate=()=>{const feedbackButtons=document.querySelectorAll('.ott-chat-response-feedback-button');if(!feedbackButtons||!feedbackButtons.length)return;const storedFeedback=sessionStorage.getItem('chatFeedback');if(storedFeedback){feedbackButtons.forEach(button=>{const shouldBeActive=(storedFeedback==='thumbs_up'&&button.classList.contains('js-up'))||(storedFeedback==='thumbs_down'&&!button.classList.contains('js-up'));if(shouldBeActive){button.classList.add('active','clicked');button.setAttribute('disabled','true')}})}
feedbackButtons.forEach(button=>{button.onclick=(event)=>{console.log(event.target);const _this=event.target;const activeButton=button.parentElement.querySelector('.active');if(_this.classList.contains('active')){_this.setAttribute('disabled','true');_this.classList.remove('active');sessionStorage.removeItem('chatFeedback')}else{_this.classList.add('active')}
if(activeButton){activeButton.classList.remove('active');activeButton.removeAttribute('disabled')}
if(_this.classList.contains('clicked')){return}
const feedbackType=_this.classList.contains('js-up')?'thumbs_up':'thumbs_down';fetch(ottSearchData.ajaxUrl,{method:'POST',credentials:'same-origin',headers:{'Content-Type':'application/x-www-form-urlencoded; charset=UTF-8'},body:`action=ott_update_feedback&feedback_type=${feedbackType}`}).then(response=>response.json()).then(data=>{if(data.success){_this.classList.add('clicked');_this.setAttribute('disabled','true');sessionStorage.setItem('chatFeedback',feedbackType)}else{console.error('Error updating feedback:',data.message)}}).catch(error=>console.error('Request failed',error))}})};const articleTemplate=(imageUri,title,summary,permalink)=>`

`;document.addEventListener('DOMContentLoaded',function(){const form=document.getElementById('ott-search-chat');const input=document.getElementById('ott-search-input');const hero=document.querySelector('.ott-search-hero');const button=document.getElementById('ott-search-submit');const chartResponseWrapper=document.getElementById('ott-chat-response-wrapper');const chatResponseContainer=document.getElementById('ott-chat-response');const chatResponseQuestion=chartResponseWrapper.querySelector('.ott-chat-response-question');const resultsWrapper=document.getElementById('ott-search-results-wrapper')
const resultsContainer=document.getElementById('ott-search-results');const sourcesListWrapper=document.getElementById('ott-sources-list-wrapper');const sourcesListContainer=document.getElementById('ott-sources-list');const faqContainer=document.getElementById('ott-faq');const loadingContainer=document.getElementById('ott-loading');const contactContainer=document.getElementById('ott-contact');const topicsContainer=document.getElementById('ott-topics');let isRequestLoading=!1;copyResponseToClipboard(chatResponseContainer,chatResponseQuestion);copyTopicUrl();feedbackRate();const faqLinks=faqContainer.querySelectorAll('.ott-link-box');faqLinks.forEach(link=>{link.addEventListener('click',function(event){event.preventDefault();const question=link.getAttribute('data-question');input.value=question;form.dispatchEvent(new Event('submit',{cancelable:!0}))})});input.addEventListener('input',function(){if(input.value){button.removeAttribute('disabled')}else{button.setAttribute('disabled','')}});form.addEventListener('submit',function(event){if(/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)){document.activeElement.blur()}
event.preventDefault();const searchQuery=input.value.trim();if(!searchQuery){resultsContainer.innerHTML='Please enter a search query.';faqContainer.classList.add('ott-hidden');return}
if(isRequestLoading)return;emptyContainers(chatResponseContainer,sourcesListContainer,resultsContainer);const questionData={action:'ott_search_proxy',query:searchQuery};isRequestLoading=!0;chatResponseQuestion.innerHTML=searchQuery.includes('?')?searchQuery:`${searchQuery}?`;loadingContainer.classList.add('ott-visible');hero.classList.add('has-results');[contactContainer,faqContainer,resultsWrapper,chartResponseWrapper,sourcesListWrapper,topicsContainer].forEach(container=>{if(!container)return;container.classList.add('ott-hidden')});fetch(ottSearchData.ajaxUrl,{method:'POST',headers:HEADERS,body:new URLSearchParams(questionData).toString()}).then(response=>response.json()).then(questionResponse=>{loadingContainer.classList.remove('ott-visible');const responseData=JSON.parse(questionResponse.data);let content=responseData.response||"No response available.";const sources=responseData.sources||[];const sourcesMapping=sources.reduce((map,source,index)=>{const referenceNumber=index+1;map[referenceNumber]=source.id;return map},{});content=content.replace(/\[(\d+)\]/g,(match,number)=>{const sourceUrl=sourcesMapping[number];return sourceUrl?`<a href="${sourceUrl}" target="_blank">${match}</a>`:match});chatResponseContainer.innerHTML=content;sources.forEach(({id,title},index)=>{const sourceItem=document.createElement('article');sourceItem.classList.add('ott-sources-article');sourceItem.innerHTML=`

						<i>(${index + 1}) <a href="${id}" target="_blank">${title}</a></i>

					`;sourcesListContainer.appendChild(sourceItem)});const docData={action:'ott_search_recommendations',data:JSON.stringify({doc:{title:searchQuery,content:content}})};return fetch(ottSearchData.ajaxUrl,{method:'POST',headers:HEADERS,body:new URLSearchParams(docData).toString()})}).then(response=>response.json()).then(recommendationsResponse=>{isRequestLoading=!1;[contactContainer,resultsWrapper,chartResponseWrapper,sourcesListWrapper,topicsContainer].forEach(container=>{if(!container)return;container.classList.remove('ott-hidden')});try{const parsedData=JSON.parse(recommendationsResponse.data);const loadMoreButton=document.querySelector('.ott-load-more-button');if(parsedData.articles&&parsedData.articles.length){if(parsedData.articles.length>3){loadMoreButton.classList.remove('ott-load-more-button-hidden')}else{loadMoreButton.classList.add('ott-load-more-button-hidden')}
parsedData.articles.forEach((article,index)=>{const{imageUri,title,summary='',permalink}=article;const articleElement=document.createElement('article');articleElement.className=`ott-article ${index > 2 ? 'hidden' : ''}`;articleElement.innerHTML=articleTemplate(imageUri,title,summary,permalink);resultsContainer.appendChild(articleElement)})}else{resultsContainer.textContent='No recommendations found.'}}catch(error){console.error('Error parsing recommendations response:',error);resultsContainer.textContent='Error fetching recommendations.';loadingContainer.classList.remove('ott-visible');isRequestLoading=!1}}).catch(error=>{console.error('Error:',error);resultsContainer.textContent='Error fetching recommendations.';loadingContainer.classList.remove('ott-visible');isRequestLoading=!1})})})